#!/usr/bin/env bash

echo "üîç Running pre-push preflight..."

# Ensure we run from the repo root
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || pwd)"
cd "$REPO_ROOT" || {
  echo "‚ùå Failed to locate repository root"
  exit 1
}

# Prefer full preflight if available
if [ -f "scripts/preflight.sh" ]; then
  bash scripts/preflight.sh || exit 1
else
  echo "‚ÑπÔ∏è scripts/preflight.sh not found; falling back to typecheck"
  if ! npm run typecheck; then
    echo "‚ùå Typecheck failed. Push blocked."
    exit 1
  fi
fi

echo "‚úÖ Pre-push checks passed"
exit 0