#!/bin/bash

echo "üîç Running pre-commit validation..."

# Validate JSON content
if [ -f "scripts/validate-content.js" ]; then
    echo "Validating JSON files..."
    if ! CI=1 node scripts/validate-content.js; then
        echo "‚ùå Pre-commit validation failed. Please fix the issues above."
        exit 1
    fi
fi

# Run backend lint and formatting checks
if [ -d "backend-node" ]; then
    if [ -f "backend-node/package.json" ]; then
        echo "Linting backend-node with ESLint (no warnings allowed)..."
        pushd backend-node >/dev/null
        if ! npm run lint -- --max-warnings=0; then
            popd >/dev/null
            echo "‚ùå ESLint failed. Please fix lint issues before committing."
            exit 1
        fi
        echo "Checking backend-node formatting with Prettier..."
        if ! npm run format:check; then
            popd >/dev/null
            echo "‚ùå Prettier check failed. Please format your code (npm run format)."
            exit 1
        fi
        popd >/dev/null
    else
        echo "‚ÑπÔ∏è Skipping backend-node lint/format: package.json not found."
    fi
fi

echo "‚úÖ Pre-commit validation passed"
exit 0